<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Sistema de facturaciÃ³n profesional">
    <title>FACTURACIÃ“N</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><circle cx='50' cy='50' r='45' fill='%233b82f6'/><text x='50%' y='52%' font-size='38' text-anchor='middle' dy='.3em' fill='white' font-family='system-ui, sans-serif' font-weight='bold'>F</text></svg>">
    <style>
        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --light: #f8fafc;
            --dark: #1e293b;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --radius: 8px;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--light);
            color: #334155;
            line-height: 1.5;
            padding: 16px;
            min-height: 100vh;
        }
        
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            border-radius: var(--radius);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }
        
        .header {
            text-align: center;
            padding: 16px 0 24px;
            border-bottom: 2px solid var(--primary);
            margin-bottom: 24px;
        }
        
        .logo {
            width: 70px;
            height: 70px;
            margin: 0 auto 12px;
            background: var(--primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 28px;
            font-weight: bold;
            box-shadow: var(--shadow);
        }
        
        h1 {
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
        }
        
        h2 {
            font-size: 18px;
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section {
            margin-bottom: 24px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .section:last-of-type {
            border-bottom: none;
        }
        
        .grid {
            display: grid;
            gap: 16px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }
        
        label {
            font-weight: 500;
            color: var(--secondary);
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: var(--radius);
            font-size: 14px;
            background: white;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .services-container {
            background: #f8fafc;
            padding: 16px;
            border-radius: var(--radius);
            margin-top: 8px;
            border: 1px solid var(--border);
        }
        
        .service-item {
            display: grid;
            grid-template-columns: 1fr 100px 60px 40px;
            gap: 8px;
            margin-bottom: 12px;
            align-items: center;
        }
        
        .service-description {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            background: white;
        }
        
        .service-price {
            padding: 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            text-align: center;
            background: white;
        }
        
        .service-subtotal {
            font-weight: 500;
            color: var(--dark);
            text-align: right;
            padding: 8px;
            font-size: 14px;
        }
        
        .btn-remove {
            background: var(--danger);
            color: white;
            border: none;
            padding: 6px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }
        
        .btn-remove:hover, .btn-remove:focus {
            background: #dc2626;
        }
        
        .btn-add {
            background: var(--success);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: var(--radius);
            cursor: pointer;
            font-size: 14px;
            margin-top: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: background-color 0.2s;
            font-weight: 500;
        }
        
        .btn-add:hover, .btn-add:focus {
            background: #0da271;
        }
        
        .summary {
            background: var(--dark);
            color: white;
            padding: 20px;
            border-radius: var(--radius);
            margin: 20px 0;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .summary-total {
            font-size: 18px;
            font-weight: 600;
            border-top: 1px solid #475569;
            padding-top: 12px;
            margin-top: 12px;
        }
        
        .actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 16px;
            border: none;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.2s;
        }
        
        .btn:focus {
            outline: 2px solid var(--primary);
            outline-offset: 2px;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover, .btn-primary:focus {
            background: var(--primary-dark);
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-success:hover, .btn-success:focus {
            background: #0da271;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-warning:hover, .btn-warning:focus {
            background: #d97706;
        }
        
        .btn-secondary {
            background: var(--secondary);
            color: white;
        }
        
        .btn-secondary:hover, .btn-secondary:focus {
            background: #475569;
        }
        
        .status {
            text-align: center;
            padding: 12px;
            margin-top: 16px;
            font-size: 14px;
            color: var(--secondary);
            min-height: 20px;
        }
        
        @media (max-width: 640px) {
            .card {
                padding: 16px;
            }
            
            .service-item {
                grid-template-columns: 1fr;
                gap: 8px;
            }
            
            .service-subtotal {
                text-align: left;
            }
            
            .actions {
                grid-template-columns: 1fr;
            }
            
            h2 {
                font-size: 16px;
            }
        }
        
        @media (min-width: 641px) {
            .grid-2 {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <div class="header">
                <div class="logo" aria-hidden="true">F</div>
                <h1>FACTURACIÃ“N</h1>
            </div>
            
            <div class="section">
                <h2><span aria-hidden="true">ðŸ“„</span> <span>EMISOR</span></h2>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="emisor">Entidad</label>
                        <input type="text" id="emisor" value="KOOWEXA">
                    </div>
                    <div class="form-group">
                        <label for="idEmisor">ID Fiscal</label>
                        <input type="text" id="idEmisor" value="IDF-2024-001">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2><span aria-hidden="true">ðŸ‘¤</span> <span>CLIENTE</span></h2>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="cliente">Nombre</label>
                        <input type="text" id="cliente" value="S.A">
                    </div>
                    <div class="form-group">
                        <label for="movil">TelÃ©fono</label>
                        <input type="text" id="movil" value="S.A">
                    </div>
                    <div class="form-group">
                        <label for="gmail">Email</label>
                        <input type="text" id="gmail" value="S.A">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2><span aria-hidden="true">ðŸ“…</span> <span>PLAZO DE TIEMPO</span></h2>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="inicio">Inicio</label>
                        <input type="text" id="inicio" value="??/??/????">
                    </div>
                    <div class="form-group">
                        <label for="vencimiento">Vencimiento</label>
                        <input type="text" id="vencimiento" value="??/??/????">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h2><span aria-hidden="true">ðŸ“‹</span> <span>DETALLES DE SERVICIOS</span></h2>
                <div class="services-container" id="detalles-container">
                    <div class="service-item">
                        <input type="text" class="service-description" value="DiseÃ±o de pÃ¡gina web">
                        <input type="number" class="service-price" value="0" step="0.01" aria-label="Precio del servicio">
                        <div class="service-subtotal">$0.00</div>
                        <button class="btn-remove" aria-label="Eliminar servicio">âœ•</button>
                    </div>
                    <div class="service-item">
                        <input type="text" class="service-description" value="Disponibilidad 24/7">
                        <input type="number" class="service-price" value="0" step="0.01" aria-label="Precio del servicio">
                        <div class="service-subtotal">$0.00</div>
                        <button class="btn-remove" aria-label="Eliminar servicio">âœ•</button>
                    </div>
                    <div class="service-item">
                        <input type="text" class="service-description" value="Actualizaciones mensuales">
                        <input type="number" class="service-price" value="0" step="0.01" aria-label="Precio del servicio">
                        <div class="service-subtotal">$0.00</div>
                        <button class="btn-remove" aria-label="Eliminar servicio">âœ•</button>
                    </div>
                </div>
                <button class="btn-add" id="btn-agregar">
                    <span aria-hidden="true">âž•</span> Agregar Servicio
                </button>
            </div>
            
            <div class="summary">
                <div class="summary-row">
                    <span>Subtotal:</span>
                    <span id="subtotal">$0.00</span>
                </div>
                <div class="summary-row">
                    <span>Impuestos (0%):</span>
                    <span id="impuestos">$0.00</span>
                </div>
                <div class="summary-row summary-total">
                    <span>TOTAL:</span>
                    <span id="total">$0.00</span>
                </div>
            </div>
            
            <div class="section">
                <h2><span aria-hidden="true">ðŸ’³</span> <span>FORMA DE PAGO</span></h2>
                <div class="grid grid-2">
                    <div class="form-group">
                        <label for="formaPago">MÃ©todo</label>
                        <select id="formaPago">
                            <option value="Transferencia bancaria">Transferencia bancaria</option>
                            <option value="Tarjeta de crÃ©dito">Tarjeta de crÃ©dito</option>
                            <option value="PayPal">PayPal</option>
                            <option value="Efectivo">Efectivo</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="fecha">Fecha factura</label>
                        <input type="text" id="fecha" value="15/11/2025">
                    </div>
                </div>
            </div>
        </div>
        
        <div class="actions">
            <button class="btn btn-primary" id="btn-recalcular">
                <span aria-hidden="true">ðŸ§®</span> Recalcular
            </button>
            <button class="btn btn-success" id="btn-automatizar">
                <span aria-hidden="true">âš¡</span> Automatizar
            </button>
            <button class="btn btn-warning" id="btn-exportar">
                <span aria-hidden="true">ðŸ“„</span> Exportar TXT
            </button>
            <button class="btn btn-secondary" id="btn-whatsapp">
                <span aria-hidden="true">ðŸ“±</span> WhatsApp
            </button>
            <button class="btn btn-secondary" id="btn-gmail">
                <span aria-hidden="true">ðŸ“§</span> Gmail
            </button>
        </div>
        
        <div class="status" id="estado" aria-live="polite"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            'use strict';
            
            class FacturaInteligente {
                constructor() {
                    this.preciosBase = {
                        'diseÃ±o': 500, 'web': 300, 'pÃ¡gina': 400, 'disponibilidad': 200,
                        'mantenimiento': 150, 'actualizaciÃ³n': 100, 'hosting': 50,
                        'dominio': 25, 'ssl': 80, 'responsive': 200, 'ecommerce': 800,
                        'consultorÃ­a': 300, 'seo': 250, 'marketing': 350
                    };
                    
                    this.init();
                }
                
                init() {
                    this.configurarEventos();
                    this.actualizarFechas();
                    this.generarIdFiscal();
                    this.calcularTotal();
                }
                
                configurarEventos() {
                    document.getElementById('btn-agregar').addEventListener('click', () => this.agregarItem());
                    document.getElementById('btn-recalcular').addEventListener('click', () => this.calcularTotal());
                    document.getElementById('btn-automatizar').addEventListener('click', () => this.automatizar());
                    document.getElementById('btn-exportar').addEventListener('click', () => this.exportarTXT());
                    document.getElementById('btn-whatsapp').addEventListener('click', () => this.enviarWhatsApp());
                    document.getElementById('btn-gmail').addEventListener('click', () => this.enviarGmail());
                    
                    document.getElementById('detalles-container').addEventListener('input', (e) => {
                        if (e.target.classList.contains('service-price') || 
                            e.target.classList.contains('service-description')) {
                            this.calcularItem(e.target);
                        }
                    });
                    
                    document.getElementById('detalles-container').addEventListener('click', (e) => {
                        if (e.target.classList.contains('btn-remove')) {
                            this.eliminarItem(e.target);
                        }
                    });
                    
                    document.getElementById('emisor').addEventListener('input', () => this.generarIdFiscal());
                }
                
                generarIdFiscal() {
                    const emisor = document.getElementById('emisor').value;
                    const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                    const fecha = new Date().getFullYear();
                    const id = `IDF-${fecha}-${random}`;
                    document.getElementById('idEmisor').value = id;
                }
                
                actualizarFechas() {
                    const hoy = new Date();
                    const vencimiento = new Date(hoy);
                    vencimiento.setDate(hoy.getDate() + 30);
                    
                    if (document.getElementById('inicio').value === '??/??/????') {
                        document.getElementById('inicio').value = hoy.toLocaleDateString('es-ES');
                    }
                    
                    if (document.getElementById('vencimiento').value === '??/??/????') {
                        document.getElementById('vencimiento').value = vencimiento.toLocaleDateString('es-ES');
                    }
                    
                    if (document.getElementById('fecha').value === '15/11/2025') {
                        document.getElementById('fecha').value = hoy.toLocaleDateString('es-ES');
                    }
                }
                
                calcularItem(elemento) {
                    const item = elemento.closest('.service-item');
                    const precio = parseFloat(item.querySelector('.service-price').value) || 0;
                    const subtotal = precio;
                    
                    item.querySelector('.service-subtotal').textContent = `$${subtotal.toFixed(2)}`;
                    this.calcularTotal();
                }
                
                calcularTotal() {
                    let subtotal = 0;
                    document.querySelectorAll('.service-item').forEach(item => {
                        const subtotalTexto = item.querySelector('.service-subtotal').textContent;
                        const valor = parseFloat(subtotalTexto.replace('$', '')) || 0;
                        subtotal += valor;
                    });
                    
                    const impuestos = subtotal * 0;
                    const total = subtotal + impuestos;
                    
                    document.getElementById('subtotal').textContent = `$${subtotal.toFixed(2)}`;
                    document.getElementById('impuestos').textContent = `$${impuestos.toFixed(2)}`;
                    document.getElementById('total').textContent = `$${total.toFixed(2)}`;
                    
                    this.mostrarEstado(`Total calculado: $${total.toFixed(2)}`, 2000);
                }
                
                sugerirPrecio(descripcion) {
                    const texto = descripcion.toLowerCase();
                    let precioSugerido = 0;
                    
                    for (const [palabra, precio] of Object.entries(this.preciosBase)) {
                        if (texto.includes(palabra)) {
                            precioSugerido = Math.max(precioSugerido, precio);
                        }
                    }
                    
                    if (precioSugerido === 0) {
                        const palabras = texto.split(' ').length;
                        precioSugerido = Math.min(palabras * 50, 500);
                    }
                    
                    return precioSugerido;
                }
                
                agregarItem() {
                    const container = document.getElementById('detalles-container');
                    const nuevoItem = document.createElement('div');
                    nuevoItem.className = 'service-item';
                    nuevoItem.innerHTML = `
                        <input type="text" class="service-description" placeholder="DescripciÃ³n del servicio">
                        <input type="number" class="service-price" value="0" step="0.01" placeholder="Precio" aria-label="Precio del servicio">
                        <div class="service-subtotal">$0.00</div>
                        <button class="btn-remove" aria-label="Eliminar servicio">âœ•</button>
                    `;
                    container.appendChild(nuevoItem);
                    this.mostrarEstado('Nuevo servicio agregado');
                }
                
                eliminarItem(boton) {
                    if (document.querySelectorAll('.service-item').length > 1) {
                        boton.closest('.service-item').remove();
                        this.calcularTotal();
                        this.mostrarEstado('Servicio eliminado');
                    } else {
                        this.mostrarEstado('Debe haber al menos un servicio');
                    }
                }
                
                automatizar() {
                    document.querySelectorAll('.service-description').forEach(input => {
                        const descripcion = input.value;
                        if (descripcion.trim()) {
                            const precioSugerido = this.sugerirPrecio(descripcion);
                            const item = input.closest('.service-item');
                            const campoPrecio = item.querySelector('.service-price');
                            
                            if (parseFloat(campoPrecio.value) === 0) {
                                campoPrecio.value = precioSugerido;
                                this.calcularItem(input);
                            }
                        }
                    });
                    
                    this.actualizarFechas();
                    this.mostrarEstado('AutomatizaciÃ³n completada âœ“');
                }
                
                obtenerDatosFactura() {
                    const items = [];
                    document.querySelectorAll('.service-item').forEach(item => {
                        const descripcion = item.querySelector('.service-description').value;
                        const precio = item.querySelector('.service-price').value;
                        const subtotal = item.querySelector('.service-subtotal').textContent;
                        
                        if (descripcion.trim()) {
                            items.push(`â€¢ ${descripcion} - Precio: $${precio} - Subtotal: ${subtotal}`);
                        }
                    });
                    
                    return {
                        emisor: document.getElementById('emisor').value,
                        id: document.getElementById('idEmisor').value,
                        cliente: document.getElementById('cliente').value,
                        movil: document.getElementById('movil').value,
                        gmail: document.getElementById('gmail').value,
                        inicio: document.getElementById('inicio').value,
                        vencimiento: document.getElementById('vencimiento').value,
                        detalles: items,
                        subtotal: document.getElementById('subtotal').textContent,
                        impuestos: document.getElementById('impuestos').textContent,
                        total: document.getElementById('total').textContent,
                        formaPago: document.getElementById('formaPago').value,
                        fecha: document.getElementById('fecha').value
                    };
                }
                
                exportarTXT() {
                    try {
                        const datos = this.obtenerDatosFactura();
                        const contenido = `FACTURA INTELIGENTE

EMISOR
Entidad: ${datos.emisor}
ID: ${datos.id}

CLIENTE
Cliente: ${datos.cliente}
TelÃ©fono: ${datos.movil}
Email: ${datos.gmail}

PLAZO DE TIEMPO
Inicio: ${datos.inicio}
Vencimiento: ${datos.vencimiento}

DETALLES
${datos.detalles.join('\n')}

RESUMEN FINANCIERO
Subtotal: ${datos.subtotal}
Impuestos: ${datos.impuestos}
TOTAL: ${datos.total}

FORMA DE PAGO
${datos.formaPago}

Fecha: ${datos.fecha}
Generado automÃ¡ticamente`;

                        const blob = new Blob([contenido], { type: 'text/plain;charset=utf-8' });
                        const url = URL.createObjectURL(blob);
                        const enlace = document.createElement('a');
                        
                        enlace.href = url;
                        enlace.download = `factura_${datos.emisor}_${datos.fecha.replace(/\//g, '-')}.txt`;
                        document.body.appendChild(enlace);
                        enlace.click();
                        document.body.removeChild(enlace);
                        URL.revokeObjectURL(url);
                        
                        this.mostrarEstado('Factura exportada como TXT âœ“');
                    } catch (error) {
                        this.mostrarEstado('Error al exportar archivo');
                    }
                }
                
                enviarWhatsApp() {
                    try {
                        const datos = this.obtenerDatosFactura();
                        const mensaje = `FACTURA ${datos.emisor}

Cliente: ${datos.cliente}
Total: ${datos.total}
Fecha: ${datos.fecha}

Para mÃ¡s detalles, exporte la factura completa.`;
                        
                        const url = `https://wa.me/?text=${encodeURIComponent(mensaje)}`;
                        window.open(url, '_blank');
                        this.mostrarEstado('Abriendo WhatsApp...');
                    } catch (error) {
                        this.mostrarEstado('Error al abrir WhatsApp');
                    }
                }
                
                enviarGmail() {
                    try {
                        const datos = this.obtenerDatosFactura();
                        const asunto = `Factura ${datos.emisor} - ${datos.total}`;
                        const cuerpo = `Adjunto encontrarÃ¡ la factura detallada.

Resumen:
- Cliente: ${datos.cliente}
- Total: ${datos.total}
- Fecha: ${datos.fecha}
- MÃ©todo de pago: ${datos.formaPago}

Saludos cordiales.`;
                        
                        const url = `mailto:?subject=${encodeURIComponent(asunto)}&body=${encodeURIComponent(cuerpo)}`;
                        window.location.href = url;
                        this.mostrarEstado('Abriendo cliente de email...');
                    } catch (error) {
                        this.mostrarEstado('Error al abrir email');
                    }
                }
                
                mostrarEstado(mensaje, tiempo = 3000) {
                    const estado = document.getElementById('estado');
                    estado.textContent = mensaje;
                    if (tiempo > 0) {
                        setTimeout(() => {
                            estado.textContent = '';
                        }, tiempo);
                    }
                }
            }

            const factura = new FacturaInteligente();
        });
    </script>
</body>
</html>